# Compiling Programs

Once you have written an SP1 program, you must compile it to an ELF file that can be executed in the zkVM. The `cargo prove` CLI tool (downloaded during installation) provides convenient commands for compiling SP1 programs.

## Compile with CLI (Development)

> WARNING: This may not generate a reproducible ELF which is necessary for verifying that your binary corresponds to given source code.
>
> Use the [reproducible build system](#build-with-docker-production) for production builds.

To build the program while in development, simply run:

```bash
cargo prove build
```

This will compile the ELF that can be executed in the zkVM and put the executable in the file `elf/riscv32im-succinct-zkvm-elf`. 

### Advanced build options

**More advanced build options**

You can pass additional arguments to the `build` command to customize the build process, like configuring what features are enabled, customizing the output directory and more. To see all available options, run `cargo prove build --help`.

**Ignore Rust version check**

If you get an error like "...", you can ignore the Rust version check by passing the `--ignore-rust-version` flag to the `build` command like so:

```bash
cargo prove build --ignore-rust-version
```

## Reproducible Builds with Docker (Production)

For production builds of programs, you can build your program inside a Docker container which will generate a **reproducible ELF** on all platforms. To do so, just use the `--docker` flag and optionally the `--tag` flag with the release version you want to use (defaults to `latest`). For example:

```bash
cargo prove build --docker --tag v1.0.1
```

To verify that your build is reproducible, you can compute the SHA-512 hash of the ELF on different platforms and systems with:

```bash
$ shasum -a 512 elf/riscv32im-succinct-zkvm-elf
f9afb8caaef10de9a8aad484c4dd3bfa54ba7218f3fc245a20e8a03ed40b38c617e175328515968aecbd3c38c47b2ca034a99e6dbc928512894f20105b03a203
```

## Build Script

> WARNING: This may not generate a reproducible ELF which is necessary for verifying that your binary corresponds to given source code.
>
> When building a ELF that will be used in production, make sure to use the [reproduction build system](../writing-programs/setup.md#build-with-docker-production).

If you want your program crate to be built automatically whenever you build/run your script crate, you can add a `build.rs` file inside of `script/` (at the same level as `Cargo.toml` of your script crate):

```rust,noplayground
{{#include ../../examples/fibonacci/script/build.rs}}
```

The path passed in to `build_program` should point to the directory containing the `Cargo.toml` file for your program. Make sure to also add `sp1-helper` as a build dependency in `script/Cargo.toml`:

```toml
[build-dependencies]
sp1-helper = { 1.1.0 }
```

You will see output like the following from the build script if the program has changed, indicating that the program was rebuilt:

````
[fibonacci-script 0.1.0] cargo:rerun-if-changed=../program/src
[fibonacci-script 0.1.0] cargo:rerun-if-changed=../program/Cargo.toml
[fibonacci-script 0.1.0] cargo:rerun-if-changed=../program/Cargo.lock
[fibonacci-script 0.1.0] cargo:warning=fibonacci-program built at 2024-03-02 22:01:26
[fibonacci-script 0.1.0] [sp1]    Compiling fibonacci-program v0.1.0 (/Users/umaroy/Documents/fibonacci/program)
[fibonacci-script 0.1.0] [sp1]     Finished release [optimized] target(s) in 0.15s
warning: fibonacci-script@0.1.0: fibonacci-program built at 2024-03-02 22:01:26```
````

The above output was generated by running `RUST_LOG=info cargo run --release -vv` for the Fibonacci example.


### Advanced build options

To configure the build process when using the `build_program` function, you can pass a `BuildArgs` struct to it. #TODO: link to the BuildArgs struct.

As an example, you could use the following code to build the Fibonacci example with a custom output directory and binary name:

```rust,noplayground
use sp1_helper::{build_program, BuildArgs};

fn main() {
    let args = BuildArgs {
        binary: "fibonacci".to_string(),
        output_directory: "./fibonacci-program".to_string(),
        ..Default::default()
    };
    build_program(&args);
}